!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function d(b,c){var e=function(){},f=this,g={autoSelectFirst:!1,appendTo:"body",serviceUrl:null,lookup:null,onSelect:null,onKeyUp:null,width:"auto",minChars:1,maxHeight:300,deferRequestBy:0,params:{},formatResult:d.formatResult,delimiter:null,zIndex:9999,type:"GET",noCache:!1,onSearchStart:e,onSearchComplete:e,containerClass:"autocomplete-suggestions",tabDisabled:!1,dataType:"text",currentRequest:null,lookupFilter:function(a,b,c){return a.value.toLowerCase().indexOf(c)!==-1},paramName:"query",transformResult:function(b){return"string"==typeof b?a.parseJSON(b):b}};f.element=b,f.el=a(b),f.suggestions=[],f.badQueries=[],f.selectedIndex=-1,f.currentValue=f.element.value,f.intervalId=0,f.cachedResponse=[],f.onChangeInterval=null,f.onChange=null,f.isLocal=!1,f.suggestionsContainer=null,f.options=a.extend({},g,c),f.classes={selected:"autocomplete-selected",suggestion:"autocomplete-suggestion"},f.hint=null,f.hintValue="",f.selection=null,f.initialize(),f.setOptions(c)}var b=function(){return{escapeRegExChars:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},createNode:function(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild}}}(),c={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40};d.utils=b,a.Autocomplete=d,d.formatResult=function(a,c){var d="("+b.escapeRegExChars(c)+")";return a.value.replace(new RegExp(d,"gi"),"<strong>$1</strong>")},d.prototype={killerFn:null,initialize:function(){var g,b=this,c="."+b.classes.suggestion,e=b.classes.selected,f=b.options;b.element.setAttribute("autocomplete","off"),b.killerFn=function(c){0===a(c.target).closest("."+b.options.containerClass).length&&(b.killSuggestions(),b.disableKillerFn())},b.suggestionsContainer=d.utils.createNode('<div class="'+f.containerClass+'" style="position: absolute; display: none;"></div>'),g=a(b.suggestionsContainer),g.appendTo(f.appendTo),"auto"!==f.width&&g.width(f.width),g.on("mouseover.autocomplete",c,function(){b.activate(a(this).data("index"))}),g.on("mouseout.autocomplete",function(){b.selectedIndex=-1,g.children("."+e).removeClass(e)}),g.on("click.autocomplete",c,function(){b.select(a(this).data("index"))}),b.fixPosition(),b.fixPositionCapture=function(){b.visible&&b.fixPosition()},a(window).on("resize",b.fixPositionCapture),b.el.on("keydown.autocomplete",function(a){b.onKeyPress(a)}),b.el.on("keyup.autocomplete",function(a){b.onKeyUp(a)}),b.el.on("blur.autocomplete",function(){b.onBlur()}),b.el.on("focus.autocomplete",function(){b.fixPosition()}),b.el.on("change.autocomplete",function(a){b.onKeyUp(a)})},onBlur:function(){this.enableKillerFn()},setOptions:function(b){var c=this,d=c.options;a.extend(d,b),c.isLocal=a.isArray(d.lookup),c.isLocal&&(d.lookup=c.verifySuggestionsFormat(d.lookup)),a(c.suggestionsContainer).css({"max-height":d.maxHeight+"px",width:d.width+"px","z-index":d.zIndex})},clearCache:function(){this.cachedResponse=[],this.badQueries=[]},clear:function(){this.clearCache(),this.currentValue="",this.suggestions=[]},disable:function(){this.disabled=!0},enable:function(){this.disabled=!1},fixPosition:function(){var c,b=this;"body"===b.options.appendTo&&(c=b.el.offset(),a(b.suggestionsContainer).css({top:c.top+b.el.outerHeight()+"px",left:c.left+"px"}))},enableKillerFn:function(){var b=this;a(document).on("click.autocomplete",b.killerFn)},disableKillerFn:function(){var b=this;a(document).off("click.autocomplete",b.killerFn)},killSuggestions:function(){var a=this;a.stopKillSuggestions(),a.intervalId=window.setInterval(function(){a.hide(),a.stopKillSuggestions()},300)},stopKillSuggestions:function(){window.clearInterval(this.intervalId)},isCursorAtEnd:function(){var d,a=this,b=a.el.val().length,c=a.element.selectionStart;return"number"==typeof c?c===b:!document.selection||(d=document.selection.createRange(),d.moveStart("character",-b),b===d.text.length)},onKeyPress:function(a){var b=this;if(!b.disabled&&!b.visible&&a.which===c.DOWN&&b.currentValue)return void b.suggest();if(!b.disabled&&b.visible){switch(a.which){case c.ESC:b.el.val(b.currentValue),b.hide();break;case c.RIGHT:if(b.hint&&b.options.onHint&&b.isCursorAtEnd()){b.selectHint();break}return;case c.TAB:if(b.hint&&b.options.onHint)return void b.selectHint();case c.RETURN:if(b.selectedIndex===-1)return void b.hide();if(b.select(b.selectedIndex),a.which===c.TAB&&b.options.tabDisabled===!1)return;break;case c.UP:b.moveUp();break;case c.DOWN:break;default:return}a.stopImmediatePropagation(),a.preventDefault()}},onKeyUp:function(a){var b=this;if(!b.disabled){switch(a.which){case c.UP:case c.DOWN:return}clearInterval(b.onChangeInterval),b.currentValue!==b.el.val()&&(b.findBestHint(),b.options.deferRequestBy>0?b.onChangeInterval=setInterval(function(){b.onValueChange()},b.options.deferRequestBy):b.onValueChange())}},onValueChange:function(){var c,b=this;b.selection&&(b.selection=null,(b.options.onInvalidateSelection||a.noop)()),clearInterval(b.onChangeInterval),b.currentValue=b.el.val(),c=b.getQuery(b.currentValue),b.selectedIndex=-1,c.length<b.options.minChars?b.hide():b.getSuggestions(c)},getQuery:function(b){var d,c=this.options.delimiter;return c?(d=b.split(c),a.trim(d[d.length-1])):a.trim(b)},getSuggestionsLocal:function(b){var c=this,d=b.toLowerCase(),e=c.options.lookupFilter;return{suggestions:a.grep(c.options.lookup,function(a){return e(a,b,d)})}},getSuggestions:function(b){var c,d=this,e=d.options,f=e.serviceUrl;if(c=d.isLocal?d.getSuggestionsLocal(b):d.cachedResponse[b],c&&a.isArray(c.suggestions))d.suggestions=c.suggestions,d.suggest();else if(!d.isBadQuery(b)){if(e.params[e.paramName]=b,e.onSearchStart.call(d.element,e.params)===!1)return;a.isFunction(e.serviceUrl)&&(f=e.serviceUrl.call(d.element,b)),null!=this.currentRequest&&this.currentRequest.abort(),this.currentRequest=a.ajax({url:f,data:e.ignoreParams?null:e.params,type:e.type,dataType:e.dataType}).done(function(a){d.processResponse(a,b),e.onSearchComplete.call(d.element,b)})}},isBadQuery:function(a){for(var b=this.badQueries,c=b.length;c--;)if(0===a.indexOf(b[c]))return!0;return!1},hide:function(){var b=this;b.visible=!1,b.selectedIndex=-1,a(b.suggestionsContainer).hide(),b.signalHint(null)},suggest:function(){if(0===this.suggestions.length)return void this.hide();var i,b=this,c=b.options.formatResult,d=b.getQuery(b.currentValue),e=b.classes.suggestion,f=b.classes.selected,g=a(b.suggestionsContainer),h="";a.each(b.suggestions,function(a,b){h+='<div class="'+e+'" data-index="'+a+'">'+c(b,d)+"</div>"}),"auto"===b.options.width&&(i=b.el.outerWidth()-2,g.width(i>0?i:300)),g.html(h).show(),b.visible=!0,b.options.autoSelectFirst&&(b.selectedIndex=0,g.children().first().addClass(f)),b.findBestHint()},findBestHint:function(){var b=this,c=b.el.val().toLowerCase(),d=null;c&&(a.each(b.suggestions,function(a,b){var e=0===b.value.toLowerCase().indexOf(c);return e&&(d=b),!e}),b.signalHint(d))},signalHint:function(b){var c="",d=this;b&&(c=d.currentValue+b.value.substr(d.currentValue.length)),d.hintValue!==c&&(d.hintValue=c,d.hint=b,(this.options.onHint||a.noop)(c))},verifySuggestionsFormat:function(b){return b.length&&"string"==typeof b[0]?a.map(b,function(a){return{value:a,data:null}}):b},processResponse:function(a,b){var c=this,d=c.options,e=d.transformResult(a,b);e.suggestions=c.verifySuggestionsFormat(e.suggestions),d.noCache||(c.cachedResponse[e[d.paramName]]=e,0===e.suggestions.length&&c.badQueries.push(e[d.paramName])),b===c.getQuery(c.currentValue)&&(c.suggestions=e.suggestions,c.suggest())},activate:function(b){var d,c=this,e=c.classes.selected,f=a(c.suggestionsContainer),g=f.children();return f.children("."+e).removeClass(e),c.selectedIndex=b,c.selectedIndex!==-1&&g.length>c.selectedIndex?(d=g.get(c.selectedIndex),a(d).addClass(e),d):null},selectHint:function(){var b=this,c=a.inArray(b.hint,b.suggestions);b.select(c)},select:function(a){var b=this;b.hide(),b.onSelect(a)},moveUp:function(){var b=this;if(b.selectedIndex!==-1)return 0===b.selectedIndex?(a(b.suggestionsContainer).children().first().removeClass(b.classes.selected),b.selectedIndex=-1,b.el.val(b.currentValue),void b.findBestHint()):void b.adjustScroll(b.selectedIndex-1)},moveDown:function(){var a=this;a.selectedIndex!==a.suggestions.length-1&&a.adjustScroll(a.selectedIndex+1)},adjustScroll:function(b){var e,f,g,c=this,d=c.activate(b),h=25;d&&(e=d.offsetTop,f=a(c.suggestionsContainer).scrollTop(),g=f+c.options.maxHeight-h,e<f?a(c.suggestionsContainer).scrollTop(e):e>g&&a(c.suggestionsContainer).scrollTop(e-c.options.maxHeight+h),c.el.val(c.getValue(c.suggestions[b].value)),c.signalHint(null))},onSelect:function(b){var c=this,d=c.options.onSelect,e=c.suggestions[b];c.currentValue=c.getValue(e.value),c.el.val(c.currentValue),c.signalHint(null),c.suggestions=[],c.selection=e,a.isFunction(d)&&d.call(c.element,e)},getValue:function(a){var d,e,b=this,c=b.options.delimiter;return c?(d=b.currentValue,e=d.split(c),1===e.length?a:d.substr(0,d.length-e[e.length-1].length)+a):a},dispose:function(){var b=this;b.el.off(".autocomplete").removeData("autocomplete"),b.disableKillerFn(),a(window).off("resize",b.fixPositionCapture),a(b.suggestionsContainer).remove()}},a.fn.autocomplete=function(b,c){var e="autocomplete";return 0===arguments.length?this.first().data(e):this.each(function(){var f=a(this),g=f.data(e);"string"==typeof b?g&&"function"==typeof g[b]&&g[b](c):(g&&g.dispose&&g.dispose(),g=new d(this,b),f.data(e,g))})}});